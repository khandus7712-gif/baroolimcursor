# 📧 이메일 알림 시스템 설정 가이드

## ✅ 구현 완료

### 1. **Resend 이메일 서비스 통합** ✅
- 무료 플랜: 100개/일, 3,000개/월
- 간단한 설정
- 빠른 발송 속도

### 2. **매일 오전 9시 Cron Job** ✅
- 오늘 발행 예정인 모든 포스트 확인
- 사용자별로 이메일 알림 발송
- 고객 100명까지 무료 가능

### 3. **모던한 이메일 템플릿** ✅
- 다크 테마 헤더
- 명확한 발행 시간 표시
- 원클릭 발행 버튼
- 발행 방법 가이드 포함

---

## 🚀 설정 방법 (5분)

### 1단계: Resend 계정 생성

1. **Resend 웹사이트 접속**
   - https://resend.com/

2. **무료 계정 가입**
   - GitHub 또는 이메일로 가입
   - 카드 등록 불필요

3. **API 키 생성**
   - Dashboard → API Keys
   - "Create API Key" 클릭
   - 이름: "Baroolim Production"
   - 생성된 키 복사 (다시 볼 수 없으니 주의!)

---

### 2단계: 도메인 인증 (선택)

**Option A: 커스텀 도메인 (권장)**
```
발신자: no-reply@baroolim.com
→ 사용자가 신뢰하기 쉬움
→ 스팸 필터 통과율 높음
```

**설정:**
1. Resend Dashboard → Domains
2. "Add Domain" 클릭
3. 도메인 입력: `baroolim.com`
4. DNS 설정에 TXT 레코드 추가
5. 인증 완료 (몇 분 소요)

**Option B: Resend 기본 도메인 (빠른 시작)**
```
발신자: onboarding@resend.dev
→ 설정 없이 바로 사용 가능
→ 개발/테스트용으로 좋음
```

---

### 3단계: 환경 변수 설정

**.env 파일에 추가:**
```bash
# Resend 이메일 서비스
RESEND_API_KEY="re_xxxxxxxxxxxxxxxxxx"

# 앱 URL (이메일 링크용)
NEXT_PUBLIC_APP_URL="http://localhost:3000"
```

**Vercel 배포 시 환경 변수:**
| 변수명 | 값 | 예시 |
|--------|-----|------|
| `RESEND_API_KEY` | Resend API 키 | `re_AbCd1234...` |
| `NEXT_PUBLIC_APP_URL` | 배포 URL | `https://baroolim.vercel.app` |

---

### 4단계: 발신자 이메일 설정

**lib/notifications.ts 파일 수정:**

```typescript
// 커스텀 도메인 사용 시
from: 'no-reply@baroolim.com'

// 또는 Resend 기본 도메인
from: 'onboarding@resend.dev'
```

현재는 `no-reply@baroolim.com`으로 설정되어 있습니다.
도메인 인증 전까지는 테스트 모드로 작동합니다.

---

## 📧 이메일 동작 방식

### 사용자 경험

**1. 콘텐츠 예약**
```
사용자: "내일 오후 3시에 발행" 예약
→ 데이터베이스에 저장
```

**2. 오전 9시 알림 (매일)**
```
Cron Job 실행 (오전 9시)
  ↓
오늘 예약된 포스트 확인
  ↓
사용자에게 이메일 발송
```

**3. 이메일 내용**
```
제목: 🔔 [바로올림] 오늘 오후 3시 00분에 콘텐츠 발행 예정이에요!

내용:
- 예약 시간 표시
- 메모 (있으면)
- "지금 바로 포스팅하기" 버튼
- 발행 방법 가이드
```

**4. 사용자 액션**
```
이메일에서 버튼 클릭
  ↓
발행 페이지로 이동
  ↓
복사 → SNS에 붙여넣기
  ↓
"발행 완료" 클릭
```

---

## 🧪 테스트하기

### 로컬 테스트

**1. 환경 변수 설정**
```bash
# .env
RESEND_API_KEY="your-api-key-here"
NEXT_PUBLIC_APP_URL="http://localhost:3000"
```

**2. 서버 실행**
```bash
npm run dev
```

**3. 테스트 예약 생성**
- `/studio`에서 콘텐츠 생성
- "예약 발행" 클릭
- 오늘 날짜, 1시간 후 시간 선택
- 예약 완료

**4. Cron Job 수동 실행**
```bash
# 브라우저에서 접속
http://localhost:3000/api/scheduled-posts/check-notifications
```

**5. 이메일 확인**
- 등록한 이메일 확인
- 알림 이메일 도착했는지 확인

---

## 📊 무료 범위 & 비용

### Resend 무료 플랜
- **100개/일** (하루)
- **3,000개/월**
- 고객 100명까지 충분

**계산:**
```
고객 100명 × 하루 평균 1개 예약 = 100건/일
→ 무료 범위 내!
```

### 고객 증가 시

| 고객 수 | 예상 알림 | 월 비용 |
|---------|----------|---------|
| ~100명 | ~3,000/월 | **무료** ✅ |
| ~300명 | ~9,000/월 | $20/월 |
| ~1000명 | ~30,000/월 | $80/월 |

**업그레이드는 나중에!**
고객이 많아지면 수익도 많아집니다. 💰

---

## ⚠️ 주의사항

### 1. API 키 보안
- ✅ `.env` 파일에만 저장
- ✅ GitHub에 커밋 안 됨 (`.gitignore`)
- ❌ 코드에 직접 작성 금지

### 2. 스팸 방지
- ✅ 이메일 마지막에 수신거부 링크 포함 (이미 구현됨)
- ✅ 발신자 이메일 명확히 표시
- ✅ 도메인 인증 (SPF, DKIM)

### 3. 발송 제한
- Resend는 하루 100개 제한
- 100명 넘으면 유료 플랜 필요
- 또는 AWS SES로 마이그레이션 (62,000/월 무료)

---

## 🔄 AWS SES로 업그레이드 (나중에)

고객이 많아지면 AWS SES 추천:
- **62,000개/월 무료**
- $0.10/1000 (이후)
- 설정이 조금 복잡하지만 저렴

**마이그레이션 시점:**
- 고객 300명 이상
- 월 10,000개 이상 발송
- 비용 절감 필요할 때

---

## 🎯 현재 상태 요약

✅ **완료:**
- Resend 라이브러리 설치
- 이메일 발송 로직 구현
- 모던한 HTML 템플릿
- Cron Job 개선 (오늘 예약 모두 처리)
- 개발 모드 (API 키 없어도 작동)

⏳ **필요:**
- Resend API 키 발급 (5분)
- 환경 변수 설정
- (선택) 도메인 인증

🚀 **배포 준비:**
- 로컬 테스트 완료 후
- Vercel에 환경 변수 추가
- 배포!

---

## 📞 문제 해결

### Q1: 이메일이 안 보내져요
**확인:**
1. `RESEND_API_KEY` 설정했나요?
2. API 키가 올바른가요?
3. 콘솔 로그 확인 (에러 메시지)

### Q2: 스팸 폴더로 가요
**해결:**
1. 도메인 인증 완료하기
2. SPF/DKIM 레코드 추가
3. 발신자 이메일 신뢰성 있게 (no-reply@baroolim.com)

### Q3: 제한 초과했어요
**해결:**
1. Resend 유료 플랜 업그레이드 ($20/월)
2. 또는 AWS SES로 마이그레이션

---

**이메일 알림 시스템 구현 완료! 🎉**

이제 Resend API 키만 발급받으면 바로 사용 가능합니다!

