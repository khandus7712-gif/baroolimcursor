# 토스페이먼츠 연동 가이드

**바로올림 결제 시스템 설정**

---

## 📋 준비 사항

### 1. 사업자 정보 (이미 준비됨 ✅)
- **사업자등록번호**: 308-32-01281
- **대표자**: 이주연
- **상호**: 바로올림
- **주소**: 경남 창원시 의창구 북면 동곡로 33, 101-1304
- **전화**: 010-5850-1255
- **이메일**: pernar.go@gmail.com

### 2. 필요한 추가 정보
- [ ] 정산 받을 은행 계좌 (은행명, 계좌번호, 예금주)
- [ ] 사업자등록증 사본 (PDF)
- [ ] 통장 사본 (정산 계좌)

---

## 🚀 월요일 진행 사항

### 1단계: 토스페이먼츠 가맹점 신청

#### 1.1 토스페이먼츠 접속
1. [토스페이먼츠](https://www.tosspayments.com/) 접속
2. **우측 상단 "가맹점 신청"** 클릭

#### 1.2 회원가입 및 신청
1. 이메일 인증: `pernar.go@gmail.com`
2. 비밀번호 설정
3. 가맹점 정보 입력:
   ```
   상호명: 바로올림
   사업자등록번호: 308-32-01281
   대표자명: 이주연
   업종: 소프트웨어 개발 및 공급업
   서비스 설명: AI 기반 마케팅 콘텐츠 자동 생성 SaaS
   웹사이트: https://baroolim.com
   ```

4. 정산 계좌 정보 입력:
   ```
   은행명: [입력 필요]
   계좌번호: [입력 필요]
   예금주: 이주연
   ```

5. 서류 업로드:
   - 사업자등록증 사본
   - 통장 사본

#### 1.3 심사 대기
- 승인까지 1-2 영업일 소요
- 담당자가 전화 또는 이메일로 연락

### 2단계: API 키 발급 (승인 후)

#### 2.1 토스페이먼츠 대시보드 접속
1. [토스페이먼츠 대시보드](https://developers.tosspayments.com/) 로그인
2. **개발자 센터** → **API 키** 메뉴

#### 2.2 API 키 확인
```
클라이언트 키 (공개 키): test_ck_* 또는 live_ck_*
시크릿 키 (비밀 키): test_sk_* 또는 live_sk_*
```

**⚠️ 주의:**
- 테스트 환경: `test_` 접두사
- 실제 환경: `live_` 접두사
- 시크릿 키는 절대 외부 노출 금지!

### 3단계: 환경 변수 설정

#### 3.1 로컬 개발 환경 (`.env.local`)
```env
# 토스페이먼츠 (테스트 환경)
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_XXXXXXXXXX
TOSS_SECRET_KEY=test_sk_XXXXXXXXXX
```

#### 3.2 Vercel 프로덕션 환경
1. [Vercel Dashboard](https://vercel.com/dashboard)
2. 프로젝트 선택 → **Settings** → **Environment Variables**
3. 추가:
   ```
   NEXT_PUBLIC_TOSS_CLIENT_KEY=live_ck_XXXXXXXXXX (Production)
   TOSS_SECRET_KEY=live_sk_XXXXXXXXXX (Production)
   ```

---

## 💳 결제 플로우

### 사용자 결제 과정

```
1. 사용자가 요금제 선택
   ↓
2. 결제 페이지로 이동 (/payment)
   ↓
3. 토스페이먼츠 결제창 팝업
   ↓
4. 결제 수단 선택 (카드/계좌이체/간편결제)
   ↓
5. 결제 승인
   ↓
6. 콜백 페이지로 리다이렉트 (/payment/success)
   ↓
7. 서버에서 결제 검증
   ↓
8. DB에 구독 정보 저장
   ↓
9. 완료 페이지 표시
```

---

## 🛠️ 구현 완료된 기능

### 1. 결제 페이지 (`/app/payment/page.tsx`)
- [x] 토스페이먼츠 SDK 통합
- [x] 요금제 선택 UI
- [x] 결제 요청 처리

### 2. 결제 성공 페이지 (`/app/payment/success/page.tsx`)
- [x] 결제 승인 확인
- [x] 구독 정보 저장
- [x] 완료 화면 표시

### 3. 결제 실패 페이지 (`/app/payment/fail/page.tsx`)
- [x] 에러 메시지 표시
- [x] 재시도 옵션

### 4. 백엔드 API
- [x] `/api/payment/checkout` - 결제 준비
- [x] `/api/payment/confirm` - 결제 승인 및 검증
- [x] `/api/payment/webhook` - 토스페이먼츠 웹훅

---

## ✅ 테스트

### 테스트 카드 번호 (토스페이먼츠 제공)

#### 승인 테스트
```
카드번호: 4571-1111-1111-1111
유효기간: 12/28
CVC: 123
비밀번호 앞 2자리: 12
```

#### 거절 테스트
```
카드번호: 4571-2222-2222-2222
```

### 테스트 순서

1. **로컬 환경에서 테스트**
   ```bash
   npm run dev
   ```
   - http://localhost:3000/pricing 접속
   - 플랜 선택
   - 테스트 카드로 결제
   - 성공 페이지 확인

2. **Vercel Preview 환경에서 테스트**
   - Pull Request 생성
   - Preview 링크에서 결제 테스트

3. **프로덕션 환경에서 실제 결제 테스트**
   - 소액(1,000원) 테스트 결제
   - 승인 후 즉시 환불

---

## 📊 대시보드 활용

### 토스페이먼츠 대시보드에서 확인 가능한 정보

1. **결제 내역**
   - 실시간 결제 현황
   - 성공/실패 통계

2. **정산 관리**
   - 정산 예정 금액
   - 정산 내역

3. **고객 관리**
   - 결제 고객 목록
   - 구독 관리

4. **통계**
   - 일/월별 매출
   - 결제 수단별 통계

---

## 🔒 보안 체크리스트

- [ ] 시크릿 키는 환경 변수로만 관리
- [ ] `.env.local` 파일은 `.gitignore`에 포함
- [ ] 프로덕션 키는 Vercel에만 저장
- [ ] 결제 검증은 반드시 서버에서 수행
- [ ] 금액 변조 방지 (서버에서 금액 재확인)
- [ ] HTTPS 사용 (Vercel 자동 제공)

---

## 📞 고객센터

### 토스페이먼츠 지원
- **이메일**: support@tosspayments.com
- **전화**: 1544-7772
- **채팅**: 대시보드 우측 하단
- **운영시간**: 평일 10:00-18:00

### 긴급 상황 대응
1. 결제 오류 발생 시: 토스페이먼츠 대시보드에서 결제 상태 확인
2. 정산 문의: 대시보드 → 정산 → 문의하기
3. 기술 지원: developers@tosspayments.com

---

## 📅 일정

### Week 1 (11월 18일 - 11월 22일)
- [x] 사전예약 페이지 오픈
- [ ] 토스페이먼츠 가맹점 신청 (월요일)
- [ ] API 키 발급 (화요일)
- [ ] 로컬 환경 테스트 (수요일)

### Week 2 (11월 25일 - 11월 29일)
- [ ] Vercel 환경 변수 설정
- [ ] Preview 환경 테스트
- [ ] 소액 실제 결제 테스트
- [ ] 프로덕션 오픈

---

## 🎉 출시 준비

### 출시 전 최종 체크리스트

- [ ] 토스페이먼츠 가맹점 승인 완료
- [ ] API 키 발급 완료
- [ ] 결제 테스트 완료
- [ ] 환불 테스트 완료
- [ ] 이용약관 및 개인정보처리방침 업데이트
- [ ] 고객센터 연락처 공지
- [ ] 사전예약자 이메일 발송

---

**💡 Tip**: 월요일에 가맹점 신청을 완료하면, 빠르면 수요일부터 실제 결제 기능을 사용할 수 있습니다!

**준비된 기능**:
- ✅ 결제 UI/UX 완성
- ✅ 백엔드 API 준비
- ✅ 데이터베이스 구조
- ⏳ API 키 발급 대기 중

**필요한 작업**:
1. 월요일 아침에 토스페이먼츠 가맹점 신청
2. API 키를 받으면 환경 변수에 입력
3. 테스트 후 바로 오픈 가능!

